{{ define "content" }}
<div class="application-main">
  {{ partial "post.html" .}}
  {{ partial "gitalk.html" . }}
</div>



<form name="comment-form" method="POST" data-netlify="true" id="commentForm">
  <input type="hidden" name="form-name" value="comment-form">
  <p>
      <label>Name: <input type="text" name="name" required></label>
  </p>
  <p>
      <label>Comment: <textarea name="comment" required></textarea></label>
  </p>
  <p>
      <button type="submit">Submit Comment</button>
  </p>
</form>

<h2>Comments:</h2>
<div id="comments-container">
  <p>Loading comments...</p>
</div>

<script>
  document.addEventListener("DOMContentLoaded", async function () {
      const commentsContainer = document.getElementById("comments-container");
  
      try {
          let response = await fetch("/.netlify/functions/fetch-comments");
          let comments = await response.json();
  
          // Ensure we have an array
          if (!Array.isArray(comments) || comments.length === 0) {
              commentsContainer.innerHTML = "<p>No comments yet.</p>";
              return;
          }
  
          commentsContainer.innerHTML = comments
              .map(comment => `
                  <div class="comment">
                      <p><strong>${comment.name}:</strong> ${comment.comment}</p>
                  </div>
              `)
              .join("");
      } catch (error) {
          commentsContainer.innerHTML = "<p>Error loading comments.</p>";
          console.error("Error fetching comments:", error);
      }
  });
  </script>

{{ end }}
